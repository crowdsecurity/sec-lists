# ------------------------------------------------------------------------
# OWASP CRS Plugin
# Copyright (c) 2022-2025 CRS project. All rights reserved.
#
# The OWASP CRS plugins are distributed under
# Apache Software License (ASL) version 2
# Please see the enclosed LICENSE file for full details.
# ------------------------------------------------------------------------

# OWASP CRS Plugin
# Plugin name: wordpress-rule-exclusions
# Plugin description:
# Rule ID block base: 9,507,000 - 9,507,999
# Plugin version: 1.1.0

# Documentation can be found here:
# https://github.com/coreruleset/wordpress-rule-exclusions-plugin

# Generic rule to disable plugin
SecRule TX:wordpress-rule-exclusions-plugin_enabled "@eq 0" "id:9507099,phase:1,pass,nolog,ctl:ruleRemoveById=9507100-9507999"


# These exclusions remedy false positives in a default WordPress install.
#
# Note that the WordPress comment field itself is currently NOT excluded
# from checking. The reason is that malicious content is regularly being
# posted to WordPress comment forms, and there have been various cases
# of XSS and even RCE vulnerabilities exploited by WordPress comments.

#
# -=[ WordPress Front-End ]=-
#


#
# [ Login form ]
#

# User login
# Being redirected to wp-admin
SecRule REQUEST_FILENAME "@rx /wp-(?:login|admin/admin-ajax)\.php$" \
    "id:9507100,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=920230;ARGS:redirect_to,\
    ctl:ruleRemoveTargetById=920273;ARGS:redirect_to,\
    ctl:ruleRemoveTargetById=931130;ARGS:redirect_to,\
    ctl:ruleRemoveTargetById=942430;ARGS:redirect_to,\
    ctl:ruleRemoveTargetById=942431;ARGS:redirect_to,\
    ctl:ruleRemoveTargetById=942432;ARGS:redirect_to,\
    ctl:ruleRemoveTargetById=920273;ARGS:user_login,\
    ctl:ruleRemoveTargetById=920273;ARGS:wp-submit,\
    ctl:ruleRemoveTargetById=932236;ARGS:wp-submit,\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:pwd,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pwd,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1-text,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass2,\
    ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Reset password
SecRule REQUEST_FILENAME "@endsWith /wp-login.php" \
    "id:9507101,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq resetpass" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1-text,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass2"

#
# [ Comments ]
#

# Post comment
SecRule REQUEST_FILENAME "@endsWith /wp-comments-post.php" \
    "id:9507120,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:author,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:comment,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:email,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:url,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

SecRule REQUEST_FILENAME "@endsWith /wp-admin/comment.php" \
    "id:9507121,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=931130;ARGS:newcomment_author_url,\
    ctl:ruleRemoveTargetByTag=attack-sqli;ARGS:newcomment_author_url,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:content,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:newcomment_author,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Replying to a comment
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507122,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq replyto-comment" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:content"


#
# [ Gutenberg Editor ]
# Used when a user (auto)saves a post/page with Gutenberg.
#

# Gutenberg full site editor (v6.3.1+).
# Editing global styles (colors, fonts, etc)
# Adding custom CSS
# Pretty Permalinks: Enabled
# This rule should be kept in sync with 9507141
SecRule REQUEST_FILENAME "@rx /wp-json/wp/v[0-9]/global-styles/[0-9]+$" \
    "id:9507140,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveById=921180,\
    ctl:ruleRemoveTargetById=920272;ARGS:json.styles.css,\
    ctl:ruleRemoveTargetById=932200;ARGS:json.styles.css,\
    ctl:ruleRemoveTargetById=942460;ARGS:json.styles.css,\
    ctl:ruleRemoveTargetById=920272;ARGS:styles.css,\
    ctl:ruleRemoveTargetById=932200;ARGS:styles.css,\
    ctl:ruleRemoveTargetById=942460;ARGS:styles.css,\
    ctl:ruleRemoveTargetById=920273;ARGS,\
    ctl:ruleRemoveTargetById=932220;ARGS,\
    ctl:ruleRemoveTargetById=932235;ARGS,\
    ctl:ruleRemoveTargetById=932236;ARGS,\
    ctl:ruleRemoveTargetById=942100;ARGS,\
    ctl:ruleRemoveTargetById=942430;ARGS,\
    ctl:ruleRemoveTargetById=942431;ARGS,\
    ctl:ruleRemoveTargetById=942432;ARGS,\
    ctl:ruleRemoveTargetById=942440;ARGS,\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES,\
    ctl:ruleRemoveTargetById=942432;ARGS_NAMES,\
    ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
    ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Gutenberg full site editor (v6.3.1+).
# Editing global styles (colors, fonts, etc)
# Adding custom CSS
# Pretty Permalinks: Disabled
# This rule should be kept in sync with 9507140
SecRule REQUEST_FILENAME "@endsWith /index.php" \
    "id:9507141,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule &ARGS:rest_route "@eq 1" \
        "t:none,\
        nolog,\
        chain"
        SecRule ARGS:rest_route "@rx ^/wp/v[0-9]+/global-styles/[0-9]+$" \
            "t:none,\
            ctl:ruleRemoveById=921180,\
            ctl:ruleRemoveTargetById=920272;ARGS:json.styles.css,\
            ctl:ruleRemoveTargetById=932200;ARGS:json.styles.css,\
            ctl:ruleRemoveTargetById=942460;ARGS:json.styles.css,\
            ctl:ruleRemoveTargetById=920272;ARGS:styles.css,\
            ctl:ruleRemoveTargetById=932200;ARGS:styles.css,\
            ctl:ruleRemoveTargetById=942460;ARGS:styles.css,\
            ctl:ruleRemoveTargetById=920273;ARGS,\
            ctl:ruleRemoveTargetById=932220;ARGS,\
            ctl:ruleRemoveTargetById=932235;ARGS,\
            ctl:ruleRemoveTargetById=932236;ARGS,\
            ctl:ruleRemoveTargetById=942100;ARGS,\
            ctl:ruleRemoveTargetById=942430;ARGS,\
            ctl:ruleRemoveTargetById=942431;ARGS,\
            ctl:ruleRemoveTargetById=942432;ARGS,\
            ctl:ruleRemoveTargetById=942440;ARGS,\
            ctl:ruleRemoveTargetById=920273;ARGS_NAMES,\
            ctl:ruleRemoveTargetById=942432;ARGS_NAMES,\
            ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
            ctl:ruleRemoveTargetById=920273;REQUEST_BODY"

# Gutenberg
# Keep in sync with rule 9507143.
SecRule REQUEST_FILENAME "@rx /wp-json/wp/v[0-9]+/(?:navigation|pages|posts|widget-types|tags|template-parts|templates|users)" \
    "id:9507142,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:content,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.content,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:content.raw,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:search,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.search,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:name,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.name,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:excerpt,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.excerpt,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:instance.raw.text,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.instance.raw.text,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Gutenberg via rest_route for sites without pretty permalinks
# Keep in sync with rule 9507142.
SecRule REQUEST_FILENAME "@endsWith /index.php" \
    "id:9507143,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule &ARGS:rest_route "@eq 1" \
        "t:none,\
        nolog,\
        chain"
        SecRule ARGS:rest_route "@rx ^/wp/v[0-9]+/(?:navigation|pages|posts|widget-types|tags|template-parts|templates|users)" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:content,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.content,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:content.raw,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:search,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.search,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:name,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.name,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:excerpt,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.excerpt,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:instance.raw.text,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:json.instance.raw.text"

# Gutenberg upload image/media
SecRule REQUEST_FILENAME "@rx /wp-json/wp/v[0-9]+/media" \
    "id:9507144,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveById=200002,\
    ctl:ruleRemoveById=200004,\
    ctl:ruleRemoveTargetById=920120;FILES:file,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Gutenberg upload image/media via rest_route for sites without pretty permalinks
SecRule REQUEST_FILENAME "@endsWith /index.php" \
    "id:9507145,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule &ARGS:rest_route "@eq 1" \
        "t:none,\
        nolog,\
        chain"
        SecRule ARGS:rest_route "@rx ^/wp/v[0-9]+/media" \
            "t:none,\
            ctl:ruleRemoveById=200002,\
            ctl:ruleRemoveById=200004"

# Cannot update items using WordPress API (Such as pages, posts or custom post types)
# Pretty permalinks: Disabled
SecRule REQUEST_FILENAME "@endsWith /index.php" \
    "id:9507146,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:rest_route "@rx ^/wp/v[0-9]+/" \
        "t:none,\
        chain"
        SecRule REQUEST_METHOD "@streq POST" \
            "t:none,\
            chain"
            SecRule REQUEST_HEADERS:x-http-method-override "@rx ^(?:PUT|DELETE)$" \
                "t:none,\
                ctl:ruleRemoveById=920450"

# Cannot update items using WordPress API (Such as pages, posts or custom post types)
# Pretty Permalinks: Enabled
SecRule REQUEST_FILENAME "@rx /wp-json/wp/v[0-9]+/" \
    "id:9507147,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule REQUEST_METHOD "@streq POST" \
        "t:none,\
        chain"
        SecRule REQUEST_HEADERS:x-http-method-override "@rx ^(?:PUT|DELETE)$" \
            "t:none,\
            ctl:ruleRemoveById=920450"

# Loading tags/catagories for pages/posts
# Obtaining metadata for pages/posts
# Loading in comments for pages/posts
SecRule REQUEST_FILENAME "@endsWith /index.php" \
    "id:9507148,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    ctl:ruleRemoveTargetById=932236;ARGS:_fields,\
    ctl:ruleRemoveTargetById=932236;ARGS:orderby"

# Adding hyperlinks in Gutenberg editor
# Embedding sites within gutenberg
# Pretty permalinks: Disabled
# Disabled rules should be kept in sync with 9507150 (Excluding ARGS:rest_route)
SecRule REQUEST_FILENAME "@endsWith /index.php" \
    "id:9507149,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:rest_route "@rx ^/(?:wp-block-editor/v[0-9.]+/url-details|oembed/[0-9.]+/proxy)$" \
        "t:none,\
        chain"
        SecRule &ARGS:rest_route "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=920273;ARGS:rest_route,\
            ctl:ruleRemoveTargetById=942432;ARGS:rest_route,\
            ctl:ruleRemoveTargetById=920272;ARGS:url,\
            ctl:ruleRemoveTargetById=920273;ARGS:url,\
            ctl:ruleRemoveTargetById=931130;ARGS:url,\
            ctl:ruleRemoveTargetById=942431;ARGS:url,\
            ctl:ruleRemoveTargetById=942432;ARGS:url,\
            ctl:ruleRemoveTargetById=920272;REQUEST_URI_RAW"

# Adding hyperlinks in Gutenberg editor
# Embedding sites within gutenberg
# Pretty permalinks: Enabled
# Disabled rules should be kept in sync with 9507149 (Excluding ARGS:rest_route)
SecRule REQUEST_FILENAME "@rx /wp-json/(?:wp-block-editor/v[0-9.]+/url-details|oembed/[0-9.]+/proxy)$" \
    "id:9507150,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    ctl:ruleRemoveTargetById=920272;ARGS:url,\
    ctl:ruleRemoveTargetById=920273;ARGS:url,\
    ctl:ruleRemoveTargetById=931130;ARGS:url,\
    ctl:ruleRemoveTargetById=942431;ARGS:url,\
    ctl:ruleRemoveTargetById=942432;ARGS:url,\
    ctl:ruleRemoveTargetById=920272;REQUEST_URI_RAW"

#
# [ Live preview ]
# Used when an administrator customizes the site and previews the result
# as a normal user.
#

# Theme select
# Example: wp_customize=on&theme=twentyfifteen&customized=
# {"old_sidebars_widgets_data":{"wp_inactive_widgets":[],
# "sidebar-1":["search-2","recent-posts-2","recent-comments-2",
# "archives-2","categories-2","meta-2"]}}&nonce=XXX&
# customize_messenger_channel=preview-0
SecRule ARGS:wp_customize "@streq on" \
    "id:9507180,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule &ARGS:action "@eq 0" \
        "t:none,\
        ctl:ruleRemoveTargetById=942200;ARGS:customized,\
        ctl:ruleRemoveTargetById=942260;ARGS:customized,\
        ctl:ruleRemoveTargetById=942300;ARGS:customized,\
        ctl:ruleRemoveTargetById=942330;ARGS:customized,\
        ctl:ruleRemoveTargetById=942340;ARGS:customized,\
        ctl:ruleRemoveTargetById=942370;ARGS:customized,\
        ctl:ruleRemoveTargetById=942430;ARGS:customized,\
        ctl:ruleRemoveTargetById=942431;ARGS:customized,\
        ctl:ruleRemoveTargetById=942460;ARGS:customized"

# Appearance -> Widgets -> Live Preview
SecRule ARGS:wp_customize "@streq on" \
    "id:9507181,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@rx ^(?:customize_save|update-widget)$" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=942200;ARGS:customized,\
            ctl:ruleRemoveTargetById=942260;ARGS:customized,\
            ctl:ruleRemoveTargetById=942300;ARGS:customized,\
            ctl:ruleRemoveTargetById=942330;ARGS:customized,\
            ctl:ruleRemoveTargetById=942340;ARGS:customized,\
            ctl:ruleRemoveTargetById=942370;ARGS:customized,\
            ctl:ruleRemoveTargetById=942430;ARGS:customized,\
            ctl:ruleRemoveTargetById=942431;ARGS:customized,\
            ctl:ruleRemoveTargetById=942460;ARGS:customized,\
            ctl:ruleRemoveTargetById=920230;ARGS:partials,\
            ctl:ruleRemoveTargetById=941320;ARGS:partials,\
            ctl:ruleRemoveTargetById=942180;ARGS:partials,\
            ctl:ruleRemoveTargetById=942200;ARGS:partials,\
            ctl:ruleRemoveTargetById=942260;ARGS:partials,\
            ctl:ruleRemoveTargetById=942330;ARGS:partials,\
            ctl:ruleRemoveTargetById=942340;ARGS:partials,\
            ctl:ruleRemoveTargetById=942370;ARGS:partials,\
            ctl:ruleRemoveTargetById=942430;ARGS:partials,\
            ctl:ruleRemoveTargetById=942431;ARGS:partials,\
            ctl:ruleRemoveTargetById=942460;ARGS:partials"

# Self calls to wp-cron.php?doing_wp_cron=[timestamp]
# These requests may be missing Accept, Content-Length headers.
# This rule must run in phase:1.
SecRule REQUEST_FILENAME "@endsWith /wp-cron.php" \
    "id:9507182,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveById=920180,\
    ctl:ruleRemoveById=920300,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Modifying widgets under Appearance --> Widgets
# Rules are disabled for all args because the paramater name keeps on changing
SecRule REQUEST_FILENAME "@rx /wp-json/batch/v[0-9]$" \
    "id:9507183,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:_locale "@streq user" \
        "t:none,\
        ctl:ruleRemoveTargetById=920272;ARGS,\
        ctl:ruleRemoveTargetById=920273;ARGS,\
        ctl:ruleRemoveTargetById=932200;ARGS,\
        ctl:ruleRemoveTargetById=932236;ARGS,\
        ctl:ruleRemoveTargetById=932240;ARGS,\
        ctl:ruleRemoveTargetById=932370;ARGS,\
        ctl:ruleRemoveTargetById=941150;ARGS,\
        ctl:ruleRemoveTargetById=941180;ARGS,\
        ctl:ruleRemoveTargetById=941181;ARGS,\
        ctl:ruleRemoveTargetById=941320;ARGS,\
        ctl:ruleRemoveTargetById=941330;ARGS,\
        ctl:ruleRemoveTargetById=942130;ARGS,\
        ctl:ruleRemoveTargetById=942131;ARGS,\
        ctl:ruleRemoveTargetById=942200;ARGS,\
        ctl:ruleRemoveTargetById=942210;ARGS,\
        ctl:ruleRemoveTargetById=942260;ARGS,\
        ctl:ruleRemoveTargetById=942330;ARGS,\
        ctl:ruleRemoveTargetById=942340;ARGS,\
        ctl:ruleRemoveTargetById=942370;ARGS,\
        ctl:ruleRemoveTargetById=942430;ARGS,\
        ctl:ruleRemoveTargetById=942431;ARGS,\
        ctl:ruleRemoveTargetById=942432;ARGS,\
        ctl:ruleRemoveTargetById=942440;ARGS,\
        ctl:ruleRemoveTargetById=942460;ARGS,\
        ctl:ruleRemoveTargetById=942520;ARGS,\
        ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
        ctl:ruleRemoveTargetById=920273;REQUEST_BODY"

# Previewing changes made to site via customizer
SecRule ARGS:wp_customize "@streq on" \
    "id:9507184,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule &ARGS:wp_customize "@eq 1" \
        "t:none,\
        ctl:ruleRemoveTargetById=920273;ARGS:customize_autosaved,\
        ctl:ruleRemoveTargetById=942432;ARGS:customize_changeset_uuid,\
        ctl:ruleRemoveTargetById=920273;ARGS:partials,\
        ctl:ruleRemoveTargetById=932200;ARGS:partials,\
        ctl:ruleRemoveTargetById=932240;ARGS:partials,\
        ctl:ruleRemoveTargetById=942370;ARGS:partials,\
        ctl:ruleRemoveTargetById=932281;ARGS:partials,\
        ctl:ruleRemoveTargetById=942430;ARGS:partials,\
        ctl:ruleRemoveTargetById=942431;ARGS:partials,\
        ctl:ruleRemoveTargetById=942432;ARGS:partials,\
        ctl:ruleRemoveTargetById=942460;ARGS:partials,\
        ctl:ruleRemoveTargetById=942520;ARGS:partials,\
        ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
        ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
        ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:customized,\
        ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:customize_changeset_uuid,\
        ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:customize_theme,\
        ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:customize_autosaved,\
        ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:customize_messenger_channel,\
        ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:customized"

# Saving changes made via site customizer
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507185,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:wp_customize "@streq on" \
        "t:none,\
        chain"
        SecRule &ARGS:wp_customize "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=942432;ARGS:customize_changeset_uuid,\
            ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
            ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:changes,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:customized,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:customize_changeset_data,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:data"

# Opening site customizer
SecRule REQUEST_FILENAME "@endsWith /wp-admin/customize.php" \
    "id:9507186,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule REQUEST_METHOD "@streq GET" \
        "t:none,\
        ctl:ruleRemoveTargetById=953101;RESPONSE_BODY,\
        ctl:ruleRemoveTargetById=956110;RESPONSE_BODY"

#
# [ Cookies ]
#

# WP Session Manager
# Cookie: _wp_session=[hex]||[timestamp]||[timestamp]
# detected SQLi using libinjection with fingerprint 'n&1'
SecRule REQUEST_COOKIES:_wp_session "@rx ^[0-9a-f]+\|\|\d+\|\|\d+$" \
    "id:9507300,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule &REQUEST_COOKIES:_wp_session "@eq 1" \
        "t:none,\
        ctl:ruleRemoveTargetById=942100;REQUEST_COOKIES:_wp_session"

#
# [ General exclusions ]
#

# Operator @unconditionalMatch is used instead of a SecAction because of a bug
# in ModSecurity v3 which prevents SecActions to be removed using ctl action.
# _wp_http_referer and wp_http_referer are passed on a lot of wp-admin pages and contain similar data.
# ARGS:s parameter can be used on any page to search the site
SecRule REQUEST_FILENAME "@unconditionalMatch" \
    "id:9507350,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=932236;ARGS:nonce,\
    ctl:ruleRemoveTargetById=942450;ARGS:nonce,\
    ctl:ruleRemoveTargetById=920230;ARGS:s,\
    ctl:ruleRemoveTargetById=920273;ARGS:s,\
    ctl:ruleRemoveTargetById=932236;ARGS:s,\
    ctl:ruleRemoveTargetById=942131;ARGS:s,\
    ctl:ruleRemoveTargetById=942200;ARGS:s,\
    ctl:ruleRemoveTargetById=942360;ARGS:s,\
    ctl:ruleRemoveTargetById=932236;ARGS:ver,\
    ctl:ruleRemoveTargetById=942450;ARGS:ver,\
    ctl:ruleRemoveTargetById=920230;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=920273;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=931130;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=932150;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=932200;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=932235;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=932236;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=932370;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=941100;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942120;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942130;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942200;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942230;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942260;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942430;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942431;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942432;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=942440;ARGS:_wp_http_referer,\
    ctl:ruleRemoveTargetById=920230;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=920273;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=931130;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=932150;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=932200;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=932235;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=932236;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=932370;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=941100;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942120;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942130;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942200;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942230;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942260;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942430;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942431;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942432;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=942440;ARGS:wp_http_referer,\
    ctl:ruleRemoveTargetById=932236;ARGS:_wpnonce,\
    ctl:ruleRemoveTargetById=942450;ARGS:_wpnonce,\
    ctl:ruleRemoveTargetById=932220;REQUEST_COOKIES,\
    ctl:ruleRemoveTargetById=942450;REQUEST_COOKIES,\
    ctl:ruleRemoveTargetById=942450;REQUEST_COOKIES_NAMES,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Searching for posts, commonly used by some themes
# Pretty permalinks: enabled
# Disabled rules should be kept in sync with 9507352
SecRule REQUEST_FILENAME "@rx /wp-json/wp/v[0-9.]+/posts$" \
    "id:9507351,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=920230;ARGS:search,\
    ctl:ruleRemoveTargetById=920273;ARGS:search,\
    ctl:ruleRemoveTargetById=932236;ARGS:search,\
    ctl:ruleRemoveTargetById=942131;ARGS:search,\
    ctl:ruleRemoveTargetById=942200;ARGS:search,\
    ctl:ruleRemoveTargetById=942360;ARGS:search,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Searching for posts, commonly used by some themes
# Pretty permalinks: disabled
# Disabled rules should be kept in sync with 9507351
SecRule REQUEST_FILENAME "@endsWith /index.php" \
    "id:9507352,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:rest_route "@rx ^/wp-json/wp/v[0-9.]+/posts$" \
        "t:none,\
        chain"
        SecRule &ARGS:rest_route "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=920230;ARGS:search,\
            ctl:ruleRemoveTargetById=920273;ARGS:search,\
            ctl:ruleRemoveTargetById=932236;ARGS:search,\
            ctl:ruleRemoveTargetById=942131;ARGS:search,\
            ctl:ruleRemoveTargetById=942200;ARGS:search,\
            ctl:ruleRemoveTargetById=942360;ARGS:search"

# `_wp_original_http_referer` and `referredby` are used by the "Classic-Editor" plugin.
# While we usually don't support plugins, this plugin restores previously existing
# core functionality.
SecRule ARGS_NAMES "@rx ^_wp_original_http_referer|referredby$" \
    "id:9507355,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=920273;ARGS:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=932235;ARGS:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=932236;ARGS:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=942120;ARGS:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=942430;ARGS:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=942431;ARGS:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=942432;ARGS:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=920273;ARGS:referredby,\
    ctl:ruleRemoveTargetById=932235;ARGS:referredby,\
    ctl:ruleRemoveTargetById=932236;ARGS:referredby,\
    ctl:ruleRemoveTargetById=942120;ARGS:referredby,\
    ctl:ruleRemoveTargetById=942430;ARGS:referredby,\
    ctl:ruleRemoveTargetById=942431;ARGS:referredby,\
    ctl:ruleRemoveTargetById=942432;ARGS:referredby,\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:_wp_original_http_referer,\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:referredby,\
    ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"


#
# -=[ WordPress Administration Back-End (wp-admin) ]=-
#

# Skip this section for performance unless /wp-admin/ is in filename

SecRule REQUEST_FILENAME "!@contains /wp-admin/" \
    "id:9507400,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    skipAfter:END-WORDPRESS-ADMIN"

SecRule REQUEST_FILENAME "!@contains /wp-admin/" \
    "id:9507401,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    skipAfter:END-WORDPRESS-ADMIN"


#
# [ Installation ]
#

# Setting up a new WordPress installation
# Entering the DB password for WordPress
SecRule REQUEST_FILENAME "@endsWith /wp-admin/setup-config.php" \
    "id:9507410,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    ctl:ruleRemoveTargetById=930130;REQUEST_FILENAME,\
    ctl:ruleRemoveTargetById=932260;ARGS_NAMES:uname,\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:pwd,\
    ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pwd"

# Allow reference to `config.php` in refereer header when setting up WordPress
SecRule REQUEST_HEADERS:Referer "@rx ^https?://[a-zA-Z0-9-.]+/wp-admin/setup-config\.php(?:\?step=[0-9])?$" \
    "id:9507411,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    ctl:ruleRemoveTargetById=930121;REQUEST_HEADERS:Referer"

# WordPress installation: exclude admin password
SecRule REQUEST_FILENAME "@endsWith /wp-admin/install.php" \
    "id:9507420,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    ctl:ruleRemoveTargetById=920273;ARGS:admin_email,\
    ctl:ruleRemoveTargetById=920273;ARGS:Submit,\
    ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:admin_password,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:admin_password2,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1-text"

#
# [ User management ]
#

# Modifying a user's profile
SecRule REQUEST_FILENAME "@rx /wp-admin/(?:profile|user-edit)\.php$" \
    "id:9507520,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq update" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=931130;ARGS:url,\
            ctl:ruleRemoveTargetById=931130;ARGS:facebook,\
            ctl:ruleRemoveTargetById=931130;ARGS:instagram,\
            ctl:ruleRemoveTargetById=931130;ARGS:linkedin,\
            ctl:ruleRemoveTargetById=931130;ARGS:myspace,\
            ctl:ruleRemoveTargetById=931130;ARGS:pinterest,\
            ctl:ruleRemoveTargetById=931130;ARGS:soundcloud,\
            ctl:ruleRemoveTargetById=931130;ARGS:tumblr,\
            ctl:ruleRemoveTargetById=931130;ARGS:youtube,\
            ctl:ruleRemoveTargetById=931130;ARGS:wikipedia,\
            ctl:ruleRemoveTargetById=931130;ARGS:github,\
            ctl:ruleRemoveTargetById=931130;ARGS:tiktok,\
            ctl:ruleRemoveTargetById=931130;ARGS:vkontakte,\
            ctl:ruleRemoveTargetById=931130;ARGS:medium,\
            ctl:ruleRemoveTargetById=931130;ARGS:twitter,\
            ctl:ruleRemoveTargetById=931130;ARGS:tsf-user-meta[facebook_page],\
            ctl:ruleRemoveTargetById=931130;ARGS:odnoklassniki,\
            ctl:ruleRemoveTargetById=931130;ARGS:vimeo,\
            ctl:ruleRemoveTargetById=931130;ARGS:dribbble,\
            ctl:ruleRemoveTargetById=931130;ARGS:wordpress,\
            ctl:ruleRemoveTargetByTag=attack-sqli;ARGS:url,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:description,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:first_name,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:last_name,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1-text,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass2"

# Create user
SecRule REQUEST_FILENAME "@endsWith /wp-admin/user-new.php" \
    "id:9507540,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq createuser" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=931130;ARGS:url,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass1-text,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:pass2"

# The ID variable is used all over wordpress
# Managing users
SecRule REQUEST_FILENAME "@rx /wp-admin/(?:admin|admin-ajax|edit|users)\.php$" \
    "id:9507601,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:id,\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:ids,\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:users[0],\
    ctl:ruleRemoveTargetById=942432;ARGS_NAMES:users[0],\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

#
# [ Content editing ]
#

# Edit posts and pages
# /wp-admin/post.php, /wp-admin/post.php?t=[timestamp]
# - Themes do not properly escape post_title in HTML, so beware of XSS
#   and be conservative in excluding this parameter.
# - Parameter _wp_http_referer can appear multiple times.
SecRule REQUEST_FILENAME "@endsWith /wp-admin/post.php" \
    "id:9507700,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@rx ^(?:edit|editpost)$" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=attack-sqli;ARGS:post_title,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:content,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:excerpt,\
            ctl:ruleRemoveById=920272,\
            ctl:ruleRemoveById=921180"

# Autosave posts and pages
# ARGS_NAMES:data[wp-check-locked-posts][] can appear multiple times
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507710,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq heartbeat" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=attack-sqli;ARGS:data[wp_autosave][post_title],\
            ctl:ruleRemoveTargetByTag=attack-xss;ARGS:data[wp_autosave][post_title],\
            ctl:ruleRemoveTargetById=932110;ARGS:data[wp_autosave][post_title],\
            ctl:ruleRemoveTargetById=932150;ARGS:data[wp_autosave][post_title],\
            ctl:ruleRemoveTargetById=941270;ARGS:data[wp_autosave][post_title],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:data[wp_autosave][content],\
            ctl:ruleRemoveTargetByTag=attack-xss;ARGS:data[wp_autosave][excerpt],\
            ctl:ruleRemoveTargetById=921110;ARGS:data[wp_autosave][excerpt],\
            ctl:ruleRemoveTargetById=932105;ARGS:data[wp_autosave][excerpt],\
            ctl:ruleRemoveTargetById=932110;ARGS:data[wp_autosave][excerpt],\
            ctl:ruleRemoveTargetById=932115;ARGS:data[wp_autosave][excerpt],\
            ctl:ruleRemoveTargetById=933210;ARGS:data[wp_autosave][excerpt],\
            ctl:ruleRemoveTargetById=942131;ARGS:data[wp_autosave][excerpt],\
            ctl:ruleRemoveTargetById=942431;ARGS_NAMES:data[wp-refresh-post-lock][post_id],\
            ctl:ruleRemoveTargetById=942431;ARGS_NAMES:data[wp-refresh-post-lock][lock],\
            ctl:ruleRemoveTargetById=942431;ARGS_NAMES:data[wp-check-locked-posts][],\
            ctl:ruleRemoveById=921180,\
            ctl:ruleRemoveById=920272"

# Edit menus
SecRule REQUEST_FILENAME "@endsWith /wp-admin/nav-menus.php" \
    "id:9507720,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@rx ^(?:update|edit)$" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@le 2" \
            "t:none,\
            ctl:ruleRemoveTargetById=920273;ARGS,\
            ctl:ruleRemoveTargetById=931130;ARGS,\
            ctl:ruleRemoveTargetById=932150;ARGS,\
            ctl:ruleRemoveTargetById=932200;ARGS,\
            ctl:ruleRemoveTargetById=941130;ARGS,\
            ctl:ruleRemoveTargetById=942100;ARGS,\
            ctl:ruleRemoveTargetById=920273;ARGS_NAMES,\
            ctl:ruleRemoveTargetById=921220;ARGS_NAMES,\
            ctl:ruleRemoveTargetById=942432;ARGS_NAMES,\
            ctl:ruleRemoveTargetById=942460;ARGS:menu-name,\
            ctl:ruleRemoveTargetById=932240;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=941330;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=941340;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942200;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942260;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942330;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942340;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942370;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942430;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942431;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942432;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942460;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942490;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=942520;ARGS:nav-menu-data,\
            ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
            ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
            ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:action,\
            ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:menu"

# Edit text widgets (can contain custom HTML)
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507730,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@rx ^(?:save-widget|update-widget)$" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[0][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[1][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[2][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[3][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[4][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[5][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[6][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[7][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[8][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[9][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[10][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[11][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[12][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[13][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[14][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[15][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[16][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[17][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[18][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[19][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[20][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[21][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[22][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[23][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[24][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[25][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[26][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[27][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[28][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[29][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[30][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[31][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[32][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[33][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[34][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[35][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[36][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[37][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[38][text],\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:widget-text[39][text]"

# Reorder widgets
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507740,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq widgets-order" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=942430;ARGS:sidebars[sidebar-1],\
            ctl:ruleRemoveTargetById=942431;ARGS:sidebars[sidebar-1],\
            ctl:ruleRemoveTargetById=942430;ARGS:sidebars[sidebar-2],\
            ctl:ruleRemoveTargetById=942431;ARGS:sidebars[sidebar-2],\
            ctl:ruleRemoveTargetById=942430;ARGS:sidebars[sidebar-3],\
            ctl:ruleRemoveTargetById=942431;ARGS:sidebars[sidebar-3],\
            ctl:ruleRemoveTargetById=942430;ARGS:sidebars[sidebar-4],\
            ctl:ruleRemoveTargetById=942431;ARGS:sidebars[sidebar-4],\
            ctl:ruleRemoveTargetById=942430;ARGS:sidebars[sidebar-5],\
            ctl:ruleRemoveTargetById=942431;ARGS:sidebars[sidebar-5],\
            ctl:ruleRemoveTargetById=942430;ARGS:sidebars[sidebar-6],\
            ctl:ruleRemoveTargetById=942431;ARGS:sidebars[sidebar-6],\
            ctl:ruleRemoveTargetById=942430;ARGS:sidebars[sidebar-7],\
            ctl:ruleRemoveTargetById=942431;ARGS:sidebars[sidebar-7]"

# Create permalink sample for new post
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507750,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq sample-permalink" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=attack-sqli;ARGS:new_title,\
            ctl:ruleRemoveTargetById=941270;ARGS:new_title"

# Add external link to menu
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507760,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq add-menu-item" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=931130;ARGS:menu-item[-1][menu-item-url]"

# Editor: Add Media, Insert Media, Insert into page
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507770,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq send-attachment-to-editor" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:html"

# Add a tag
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507780,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq add-tag" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=attack-xss;ARGS:description"

# Upload media
SecRule REQUEST_FILENAME "@endsWith /wp-admin/async-upload.php" \
    "id:9507790,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq upload-attachment" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=920120;FILES:async-upload,\
            ctl:ruleRemoveTargetById=933210;ARGS:name,\
            ctl:ruleRemoveTargetById=942100;ARGS:name"

# Modify media
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507791,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq save-attachment" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=932100;ARGS:changes[caption],\
            ctl:ruleRemoveTargetById=941100;ARGS:changes[caption],\
            ctl:ruleRemoveTargetById=941160;ARGS:changes[caption],\
            ctl:ruleRemoveTargetById=932130;ARGS:changes[smush],\
            ctl:ruleRemoveTargetById=941310;ARGS:changes[smush],\
            ctl:ruleRemoveTargetByTag=attack-xss;ARGS:changes[compat][item],\
            ctl:ruleRemoveTargetById=932130;ARGS:changes[compat][item],\
            ctl:ruleRemoveTargetById=933210;ARGS:changes[compat][item]"

# Allow PHP source code to be returned when using the plugin/theme editor
SecRule REQUEST_FILENAME "@rx /wp-admin/(?:plugin|theme)-editor\.php$" \
    "id:9507792,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule REQUEST_METHOD "@streq GET" \
        "t:none,\
        ctl:ruleRemoveByTag=OWASP_CRS/DATA-LEAKAGES-PHP"

# Embedding XHTML file
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507793,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq parse-embed" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=941130;ARGS:shortcode"

#
# [ Options and Settings ]
#

# Change site URL
SecRule REQUEST_FILENAME "@endsWith /wp-admin/options.php" \
    "id:9507800,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:option_page "@streq general" \
        "t:none,\
        chain"
        SecRule &ARGS:option_page "@eq 1" \
            "t:none,\
            chain"
            SecRule ARGS:action "@streq update" \
                "t:none,\
                chain"
                SecRule &ARGS:action "@eq 1" \
                    "t:none,\
                    ctl:ruleRemoveTargetById=931130;ARGS:home,\
                    ctl:ruleRemoveTargetById=931130;ARGS:siteurl"

# Permalink settings
# permalink_structure=/index.php/%year%/%monthnum%/%day%/%postname%/
SecRule REQUEST_FILENAME "@endsWith /wp-admin/options-permalink.php" \
    "id:9507810,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=920230;ARGS:selection,\
    ctl:ruleRemoveTargetById=920272;ARGS:selection,\
    ctl:ruleRemoveTargetById=942431;ARGS:selection,\
    ctl:ruleRemoveTargetById=920230;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=920272;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=942100;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=942130;ARGS:tag_base,\
    ctl:ruleRemoveTargetById=942130;ARGS:category_base,\
    ctl:ruleRemoveTargetById=942130;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=942180;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=942330;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=942390;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=942390;ARGS:category_base,\
    ctl:ruleRemoveTargetById=942390;ARGS:tag_base,\
    ctl:ruleRemoveTargetById=942431;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=942521;ARGS:permalink_structure,\
    ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Comments deny list and moderation list
SecRule REQUEST_FILENAME "@endsWith /wp-admin/options.php" \
    "id:9507820,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:option_page "@streq discussion" \
        "t:none,\
        chain"
        SecRule &ARGS:option_page "@eq 1" \
            "t:none,\
            chain"
            SecRule ARGS:action "@streq update" \
                "t:none,\
                chain"
                SecRule &ARGS:action "@eq 1" \
                    "t:none,\
                    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:disallowed_keys,\
                    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:blacklist_keys,\
                    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:moderation_keys"

# Posts/pages overview search
SecRule REQUEST_FILENAME "@endsWith /wp-admin/edit.php" \
    "id:9507830,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:cat,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:s,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"


#
# [ Helpers ]
#

SecRule REQUEST_FILENAME "@rx /wp-admin/load-(?:scripts|styles)\.php$" \
    "id:9507900,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveById=921180,\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:load[],\
    ctl:ruleRemoveTargetById=921220;ARGS_NAMES:load[],\
    ctl:ruleRemoveTargetById=942432;ARGS_NAMES:load[],\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:load[chunk_0],\
    ctl:ruleRemoveTargetById=921220;ARGS_NAMES:load[chunk_0],\
    ctl:ruleRemoveTargetById=942432;ARGS_NAMES:load[chunk_0],\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:load[chunk_1],\
    ctl:ruleRemoveTargetById=921220;ARGS_NAMES:load[chunk_1],\
    ctl:ruleRemoveTargetById=942432;ARGS_NAMES:load[chunk_1],\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:load[chunk_2],\
    ctl:ruleRemoveTargetById=921220;ARGS_NAMES:load[chunk_2],\
    ctl:ruleRemoveTargetById=942432;ARGS_NAMES:load[chunk_2],\
    ctl:ruleRemoveTargetById=920273;ARGS_NAMES:load[chunk_3],\
    ctl:ruleRemoveTargetById=921220;ARGS_NAMES:load[chunk_3],\
    ctl:ruleRemoveTargetById=942432;ARGS_NAMES:load[chunk_3],\
    ctl:ruleRemoveTargetById=932236;ARGS:load[],\
    ctl:ruleRemoveTargetById=942360;ARGS:load[],\
    ctl:ruleRemoveTargetById=942430;ARGS:load[],\
    ctl:ruleRemoveTargetById=942431;ARGS:load[],\
    ctl:ruleRemoveTargetById=942432;ARGS:load[],\
    ctl:ruleRemoveTargetById=932236;ARGS:load[chunk_0],\
    ctl:ruleRemoveTargetById=942360;ARGS:load[chunk_0],\
    ctl:ruleRemoveTargetById=942430;ARGS:load[chunk_0],\
    ctl:ruleRemoveTargetById=942431;ARGS:load[chunk_0],\
    ctl:ruleRemoveTargetById=942432;ARGS:load[chunk_0],\
    ctl:ruleRemoveTargetById=932236;ARGS:load[chunk_1],\
    ctl:ruleRemoveTargetById=942360;ARGS:load[chunk_1],\
    ctl:ruleRemoveTargetById=942430;ARGS:load[chunk_1],\
    ctl:ruleRemoveTargetById=942431;ARGS:load[chunk_1],\
    ctl:ruleRemoveTargetById=942432;ARGS:load[chunk_1],\
    ctl:ruleRemoveTargetById=932236;ARGS:load[chunk_2],\
    ctl:ruleRemoveTargetById=942360;ARGS:load[chunk_2],\
    ctl:ruleRemoveTargetById=942430;ARGS:load[chunk_2],\
    ctl:ruleRemoveTargetById=942431;ARGS:load[chunk_2],\
    ctl:ruleRemoveTargetById=942432;ARGS:load[chunk_2],\
    ctl:ruleRemoveTargetById=932236;ARGS:load[chunk_3],\
    ctl:ruleRemoveTargetById=942360;ARGS:load[chunk_3],\
    ctl:ruleRemoveTargetById=942430;ARGS:load[chunk_3],\
    ctl:ruleRemoveTargetById=942431;ARGS:load[chunk_3],\
    ctl:ruleRemoveTargetById=942432;ARGS:load[chunk_3],\
    ctl:ruleRemoveTargetById=920100;REQUEST_LINE,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0'"

# Wordpress Site Health
# The wordpress site health page makes use of embedded SQL/PHP
# which triggers PHP/SQL leak rules.
SecRule REQUEST_FILENAME "@endsWith /wp-admin/site-health.php" \
    "id:9507910,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule REQUEST_METHOD "@streq GET" \
        "t:none,\
        ctl:ruleRemoveById=951220,\
        ctl:ruleRemoveById=953110"


#
# [ Plugins management ]
#

# Updating or deleting a plugin
SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507970,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@rx ^(?:update-plugin|delete-plugin)$" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetById=932120;ARGS:plugin,\
            ctl:ruleRemoveTargetById=932120;ARGS:slug"

SecRule REQUEST_FILENAME "@endsWith /wp-admin/admin-ajax.php" \
    "id:9507971,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq edit-theme-plugin-file" \
        "t:none,\
        chain"
        SecRule &ARGS:action "@eq 1" \
            "t:none,\
            ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:newcontent"

# Opening the plugins page
# Exclusion of rule 951240 together with test 9507971-4 can be removed after we drop
# support for CRS 3.
SecRule REQUEST_FILENAME "@rx /wp-admin/(?:plugins|plugin-install)\.php$" \
    "id:9507972,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    ctl:ruleRemoveTargetById=951230;RESPONSE_BODY,\
    ctl:ruleRemoveTargetById=951240;RESPONSE_BODY,\
    ctl:ruleRemoveTargetById=953100;RESPONSE_BODY,\
    ctl:ruleRemoveTargetById=953110;RESPONSE_BODY,\
    ctl:ruleRemoveTargetById=953101;RESPONSE_BODY"

# Uploading plugins as a zip file
SecRule REQUEST_FILENAME "@endsWith /wp-admin/update.php" \
    "id:9507973,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    chain"
    SecRule ARGS:action "@streq upload-plugin" \
        "t:none,\
        chain"
        SecRule FILES:pluginzip "@endsWith .zip" \
            "t:none,\
            ctl:ruleRemoveTargetById=944110;REQUEST_BODY,\
            ctl:ruleRemoveTargetById=944250;REQUEST_BODY"

# Installing a plugin via zip file upload
SecRule REQUEST_FILENAME "@endsWith /wp-admin/update.php" \
    "id:9507974,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'wordpress-rule-exclusions-plugin/1.1.0',\
    ctl:ruleRemoveTargetById=932236;ARGS:install-plugin-submit"

SecMarker "END-WORDPRESS-ADMIN"
